head	1.14;
access;
symbols;
locks; strict;
comment	@ * @;


1.14
date	2007.08.17.14.45.00;	author lewis;	state Exp;
branches;
next	1.13;

1.13
date	2007.08.17.12.06.18;	author lewis;	state Exp;
branches;
next	1.12;

1.12
date	2007.08.17.08.16.32;	author lewis;	state Exp;
branches;
next	1.11;

1.11
date	2007.08.16.14.33.35;	author lewis;	state Exp;
branches;
next	1.10;

1.10
date	2007.08.15.12.55.35;	author lewis;	state Exp;
branches;
next	1.9;

1.9
date	2007.08.14.11.56.42;	author lewis;	state Exp;
branches;
next	1.8;

1.8
date	2007.07.20.14.49.26;	author lewis;	state Exp;
branches;
next	1.7;

1.7
date	2007.07.11.14.22.10;	author lewis;	state Exp;
branches;
next	1.6;

1.6
date	2007.07.03.14.20.42;	author lewis;	state Exp;
branches;
next	1.5;

1.5
date	2007.07.03.08.29.06;	author lewis;	state Exp;
branches;
next	1.4;

1.4
date	2007.07.02.16.06.07;	author lewis;	state Exp;
branches;
next	1.3;

1.3
date	2007.06.21.14.48.34;	author lewis;	state Exp;
branches;
next	1.2;

1.2
date	2007.06.13.15.35.34;	author lewis;	state Exp;
branches;
next	1.1;

1.1
date	2007.06.07.15.28.57;	author lewis;	state Exp;
branches;
next	;


desc
@@


1.14
log
@Added Reset command
@
text
@/**************************************************************************/
/* Command line stuff                                                     */
/**************************************************************************/

int Illegal();              /* llegal command */

int Quit();                 /* Quit test program  */
int Help();                 /* Help on commands   */
int News();                 /* Show GMT test news */
int History();              /* History            */
int Shell();                /* Shell command      */
int Sleep();                /* Sleep seconds      */
int Pause();                /* Pause keyboard     */
int Atoms();                /* Atom list commands */
int List();                 /* List files         */
int Clean();                /* Clean files        */

int ChangeEditor();
int ChangeDirectory();
int GetVersion();
int RemGetVersion();

int SaveDscList();
int LoadDscList();
int ClearDsc();
int ClearAllDscs();

int GetSetDsc();
int NextDsc();
int GetStatus();
int KillSurvey();
int PingSurvey();
int StartSurvey();
int ResetSurvey();
int GetCcv();
int GetAqn();
int GetLsp();
int RemGetStatus();
int RemGetCcv();
int RemGetAqn();
int RemGetLsp();
int GetSetTxt();
int SaveAqn();
int RestAqn();
int SaveCcv();
int RestCcv();
int CompareAqn();
int CompareCcv();
int GetSetSampling();
int GetHelp();
int GetSetDebug();

/* Commands */

typedef enum {

   CmdNOCM,  /* llegal command */

   CmdQUIT,  /* Quit test program  */
   CmdHELP,  /* Help on commands   */
   CmdNEWS,  /* Show GMT test news */
   CmdHIST,  /* History            */
   CmdSHELL, /* Shell command      */
   CmdSLEEP, /* Sleep seconds      */
   CmdPAUSE, /* Pause keyboard     */
   CmdATOMS, /* Atom list commands */

   CmdCE,    /* Change text editor   */
   CmdCD,    /* Change configuration */
   CmdLS,    /* List files */
   CmdRM,    /* Remove files */
   CmdVER,   /* Get all versions */
   CmdRVER,  /* Remote get all versions */

   CmdDSC,   /* Select target DSC */
   CmdND,    /* Next DSC */
   CmdSDSCL, /* Save list of DSCs to file */
   CmdLDSCL, /* Load list of DSCs from file */
   CmdXDSC,  /* Delete current DSC from list */
   CmdXDSCL, /* Delete DSC list */

   CmdRST,   /* Read target status */
   CmdKIL,   /* Kill survey daemons */
   CmdPNG,   /* Ping daemon on DSC */
   CmdSTD,   /* Start daemon on DSC */
   CmdXEH,   /* Delete/Clear Error history */
   CmdCCV,   /* Read target control values */
   CmdAQN,   /* Read target acquisition values */
   CmdLSP,   /* Read target PTIM list */
   CmdTXT,   /* Set target text mode */
   CmdSMP,   /* Get/Set AQN sampling */
   CmdRH,    /* Get remote help, ping */
   CmdRD,    /* Get/Set remote debug printing */

   CmdRRST,  /* Remote read target status */
   CmdRCCV,  /* Remote read target control values */
   CmdRAQN,  /* Remote read target acquisition values */
   CmdRLSP,  /* Remote read target PTIM list */

   CmdSAQN,  /* Save aqn in reference */
   CmdOAQN,  /* Restore aqn from reference */
   CmdSCCV,  /* Save ccv in reference */
   CmdOCCV,  /* Restore ccv from reference */

   CmdCAQN,  /* Compare aqn with reference */
   CmdCCCV,  /* Compare ccv with reference */

   CmdCMDS } CmdId;

typedef struct {
   CmdId  Id;
   char  *Name;
   char  *Help;
   char  *Optns;
   int  (*Proc)(); } Cmd;

static Cmd cmds[CmdCMDS] = {

   { CmdNOCM,   "???",    "Illegal command"            ,""        ,Illegal },

   { CmdQUIT,    "q" ,    "Quit test program"          ,""        ,Quit    },
   { CmdHELP,    "h" ,    "Help on commands"           ,""        ,Help    },
   { CmdNEWS,    "news",  "Show GMT test news"         ,""        ,News    },
   { CmdHIST,    "his",   "History"                    ,""        ,History },
   { CmdSHELL,   "sh",    "Shell command"              ,"UnixCmd" ,Shell   },
   { CmdSLEEP,   "s" ,    "Sleep seconds"              ,"Seconds" ,Sleep   },
   { CmdPAUSE,   "z" ,    "Pause keyboard"             ,""        ,Pause   },
   { CmdATOMS,   "a" ,    "Atom list commands"         ,""        ,Atoms   },

   { CmdCE,      "ce",    "Change text editor"         ,""        ,ChangeEditor    },
   { CmdCD,      "cd",    "Change configuration"       ,"Path"    ,ChangeDirectory },
   { CmdLS,      "ls",    "List files in /tmp"         ,""        ,List            },
   { CmdRM,      "clean", "Clean files from /tmp"      ,""        ,Clean           },
   { CmdVER,     "ver",   "Get all versions"           ,""        ,GetVersion      },
   { CmdRVER,    "rver",  "Remote get all versions"    ,""        ,RemGetVersion   },

   { CmdDSC,     "dsc",   "Select target DSC"          ,"Name"    ,GetSetDsc    },
   { CmdND,      "nd",    "Next DSC"                   ,""        ,NextDsc      },
   { CmdSDSCL,   "sdscl", "Save DSC list to file"      ,"Path"    ,SaveDscList  },
   { CmdLDSCL,   "ldscl", "Load DSC list from file"    ,"Path"    ,LoadDscList  },
   { CmdXDSC,    "xdsc",  "Delete DSC from list"       ,""        ,ClearDsc     },
   { CmdXDSCL,   "xdscl", "Delete DSC list"            ,""        ,ClearAllDscs },

   { CmdRST,     "rst",   "Read target status"         ,""        ,GetStatus   },
   { CmdKIL,     "kill",  "Kill survey daemons on DSCs",""        ,KillSurvey  },
   { CmdPNG,     "ping",  "Ping survey daemon on DSC"  ,""        ,PingSurvey  },
   { CmdSTD,     "start", "Start survey daemon on DSC" ,""        ,StartSurvey },
   { CmdXEH,     "xeh",   "Delete/Clear Error history" ,""        ,ResetSurvey },

   { CmdCCV,     "ccv",   "Read target control"        ,"Mask"    ,GetCcv     },
   { CmdAQN,     "aqn",   "Read target acquisition"    ,""        ,GetAqn     },
   { CmdLSP,     "lsp",   "Read target PTIM list"      ,""        ,GetLsp     },
   { CmdTXT,     "txt",   "Set target text mode"       ,"0|1"     ,GetSetTxt  },
   { CmdSMP,     "smp",   "Get/Set AQN sampling"       ,"Mask"    ,GetSetSampling },
   { CmdRH,      "rh",    "Get remote help, ping DSCs" ,""        ,GetHelp        },
   { CmdRD,      "deb",   "Get/Set remote debug print" ,"0|1"     ,GetSetDebug    },

   { CmdRRST,    "rrst",  "Remote read status"         ,""        ,RemGetStatus },
   { CmdRCCV,    "rccv",  "Remote read ccvs"           ,""        ,RemGetCcv    },
   { CmdRAQN,    "raqn",  "Remote read aqns"           ,""        ,RemGetAqn    },
   { CmdRLSP,    "rlsp",  "Remote read ptms"           ,""        ,RemGetLsp    },

   { CmdSAQN,    "saqn",  "Save aqn in reference"        ,""        ,SaveAqn    },
   { CmdOAQN,    "oaqn",  "Overwrite aqn from reference" ,""        ,RestAqn    },
   { CmdSCCV,    "sccv",  "Save ccv in reference"        ,""        ,SaveCcv    },
   { CmdOCCV,    "occv",  "Overwrite ccv from reference" ,""        ,RestCcv    },

   { CmdCAQN,    "caqn",  "Compare aqn with reference" ,""        ,CompareAqn   },
   { CmdCCCV,    "cccv",  "Compare ccv with reference" ,""        ,CompareCcv } };

typedef enum {

   OprNOOP,

   OprNE,  OprEQ,  OprGT,  OprGE,  OprLT , OprLE,   OprAS,
   OprPL,  OprMI,  OprTI,  OprDI,  OprAND, OprOR,   OprXOR,
   OprNOT, OprNEG, OprLSH, OprRSH, OprINC, OprDECR, OprPOP,
   OprSTM,

   OprOPRS } OprId;

typedef struct {
   OprId  Id;
   char  *Name;
   char  *Help; } Opr;

static Opr oprs[OprOPRS] = {
   { OprNOOP, "?"  ,"???     Not an operator"       },
   { OprNE,   "#"  ,"Test:   Not equal"             },
   { OprEQ,   "="  ,"Test:   Equal"                 },
   { OprGT,   ">"  ,"Test:   Greater than"          },
   { OprGE,   ">=" ,"Test:   Greater than or equal" },
   { OprLT,   "<"  ,"Test:   Less than"             },
   { OprLE,   "<=" ,"Test:   Less than or equal"    },
   { OprAS,   ":=" ,"Assign: Becomes equal"         },
   { OprPL,   "+"  ,"Arith:  Add"                   },
   { OprMI,   "-"  ,"Arith:  Subtract"              },
   { OprTI,   "*"  ,"Arith:  Multiply"              },
   { OprDI,   "/"  ,"Arith:  Divide"                },
   { OprAND,  "&"  ,"Bits:   AND"                   },
   { OprOR,   "!"  ,"Bits:   OR"                    },
   { OprXOR,  "!!" ,"Bits:   XOR"                   },
   { OprNOT,  "##" ,"Bits:   Ones Compliment"       },
   { OprNEG,  "#-" ,"Arith:  Twos compliment"       },
   { OprLSH,  "<<" ,"Bits:   Left shift"            },
   { OprRSH,  ">>" ,"Bits:   Right shift"           },
   { OprINC,  "++" ,"Arith:  Increment"             },
   { OprDECR, "--" ,"Arith:  Decrement"             },
   { OprPOP,  ";"  ,"Stack:  POP"                   },
   { OprSTM,  "->" ,"Stack:  PUSH"                  } };

static char atomhash[256] = {
  10,9,9,9,9,9,9,9,9,0,0,9,9,0,9 ,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
  0 ,1,9,1,9,4,1,9,2,3,1,1,0,1,11,1,5,5,5,5,5,5,5,5,5,5,1,1,1,1,1,1,
  10,6,6,6,6,6,6,6,6,6,6,6,6,6,6 ,6,6,6,6,6,6,6,6,6,6,6,6,7,9,8,9,6,
  9 ,6,6,6,6,6,6,6,6,6,6,6,6,6,6 ,6,6,6,6,6,6,6,6,6,6,6,6,9,9,9,9,9,
  9 ,9,9,9,9,9,9,9,9,9,9,9,9,9,9 ,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
  9 ,9,9,9,9,9,9,9,9,9,9,9,9,9,9 ,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
  9 ,9,9,9,9,9,9,9,9,9,9,9,9,9,9 ,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
  9 ,9,9,9,9,9,9,9,9,9,9,9,9,9,9 ,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9 };

typedef enum {
   Seperator=0,Operator=1,Open=2,Close=3,Comment=4,Numeric=5,Alpha=6,
   Open_index=7,Close_index=8,Illegal_char=9,Terminator=10,Bit=11,
 } AtomType;

#define MAX_ARG_LENGTH  32
#define MAX_ARG_COUNT   16
#define MAX_ARG_HISTORY 16

typedef struct {
   int      Pos;
   int      Number;
   AtomType Type;
   char     Text[MAX_ARG_LENGTH];
   CmdId    CId;
   OprId    OId;
} ArgVal;

static int pcnt = 0;
static ArgVal val_bufs[MAX_ARG_HISTORY][MAX_ARG_COUNT];
static ArgVal *vals = val_bufs[0];

#ifndef True
#define True 1
#define False 0
#endif
@


1.13
log
@Added sdscl xdscl xdsc ldscl commands
@
text
@d34 1
d86 1
d144 6
a149 4
   { CmdRST,     "rst",   "Read target status"         ,""        ,GetStatus  },
   { CmdKIL,     "kill",  "Kill survey daemons on DSCs",""        ,KillSurvey },
   { CmdPNG,     "ping",  "Ping survey daemon on DSC"  ,""        ,PingSurvey },
   { CmdSTD,     "start", "Start survey daemon on DSC" ,""        ,StartSurvey},
@


1.12
log
@Added Ping and Start
@
text
@d23 5
d76 4
d135 6
a140 2
   { CmdDSC,     "dsc",   "Select target DSC"          ,"Name"    ,GetSetDsc  },
   { CmdND,      "nd",    "Next DSC"                   ,""        ,NextDsc    },
@


1.11
log
@*** empty log message ***
@
text
@d27 2
d74 2
d131 2
@


1.10
log
@Added Remote Get Version
@
text
@d16 1
d63 1
d117 2
a118 1
   { CmdLS,      "ls",    "List files"                 ,""        ,List            },
@


1.9
log
@Added Kill
@
text
@d20 1
d62 2
a63 1
   CmdVER,   /* Get version */
d116 2
a117 1
   { CmdVER,     "ver",   "Get TimLib version"         ,""        ,GetVersion      },
@


1.8
log
@*** empty log message ***
@
text
@d24 1
d67 1
d120 1
@


1.7
log
@*** empty log message ***
@
text
@d118 1
a118 1
   { CmdCCV,     "ccv",   "Read target control"        ,""        ,GetCcv     },
@


1.6
log
@*** empty log message ***
@
text
@d15 1
a22 3
int GetSetMod();
int NextMod();
int PrevMod();
d59 1
a63 3
   CmdMOD,   /* Select target module */
   CmdNM,    /* Next target module */
   CmdPM,    /* Previous target module */
d111 1
a115 3
   { CmdMOD,     "mo",    "Select target module"       ,"Module"  ,GetSetMod  },
   { CmdNM,      "nm",    "Next target module"         ,""        ,NextMod    },
   { CmdPM,      "pm",    "Previous target module"     ,""        ,PrevMod    },
d122 1
a122 1
   { CmdSMP,     "smp",   "Get/Set AQN sampling"       ,"0|1"     ,GetSetSampling },
@


1.5
log
@*** empty log message ***
@
text
@d42 1
d76 1
d130 1
@


1.4
log
@*** empty log message ***
@
text
@d41 1
d74 1
d127 1
@


1.3
log
@*** empty log message ***
@
text
@d21 1
d35 1
d37 1
d40 1
d62 1
d72 1
d80 1
d82 1
d114 1
d124 1
d131 4
a134 2
   { CmdSAQN,    "saqn",  "Save aqn in reference"      ,""        ,SaveAqn    },
   { CmdSCCV,    "sccv",  "Save ccv in reference"      ,""        ,SaveCcv    },
@


1.2
log
@*** empty log message ***
@
text
@d28 4
d33 3
a35 3
int PlotAqn();
int EditFilt();
int WriteCcv();
d68 4
a71 2
   CmdPLOT,  /* Plot acquisitions */
   CmdFILT,  /* Specify PTIM filter */
d73 5
a77 2
   CmdWCCV,  /* Save target CCVs in reference */
   CmdCMP,   /* Compare CCVs with reference */
d90 1
a90 1
   { CmdNOCM,   "???",    "Illegal command"          ,""                   ,Illegal },
d92 28
a119 23
   { CmdQUIT,    "q" ,    "Quit test program"        ,""                   ,Quit    },
   { CmdHELP,    "h" ,    "Help on commands"         ,""                   ,Help    },
   { CmdNEWS,    "news",  "Show GMT test news"       ,""                   ,News    },
   { CmdHIST,    "his",   "History"                  ,""                   ,History },
   { CmdSHELL,   "sh",    "Shell command"            ,"UnixCmd"            ,Shell   },
   { CmdSLEEP,   "s" ,    "Sleep seconds"            ,"Seconds"            ,Sleep   },
   { CmdPAUSE,   "z" ,    "Pause keyboard"           ,""                   ,Pause   },
   { CmdATOMS,   "a" ,    "Atom list commands"       ,""                   ,Atoms   },

   { CmdCE,      "ce",    "Change text editor"       ,""                   ,ChangeEditor    },
   { CmdCD,      "cd",    "Change configuration"     ,"Path"               ,ChangeDirectory },
   { CmdVER,     "ver",   "Get TimLib version"       ,""                   ,GetVersion      },

   { CmdDSC,     "dsc",   "Select target DSC"        ,"Name"               ,GetSetDsc  },
   { CmdMOD,     "mo",    "Select target module"     ,"Module"             ,GetSetMod  },
   { CmdNM,      "nm",    "Next target module"       ,""                   ,NextMod    },
   { CmdPM,      "pm",    "Previous target module"   ,""                   ,PrevMod    },

   { CmdRST,     "rst",   "Read target status"       ,""                   ,GetStatus  },
   { CmdCCV,     "ccv",   "Read target control"      ,""                   ,GetCcv     },
   { CmdAQN,     "aqn",   "Read target acquisition"  ,""                   ,GetAqn     },
   { CmdLSP,     "lsp",   "Read target PTIM list"    ,""                   ,GetLsp     },
   { CmdTXT,     "txt",   "Set target text mode"     ,"0|1"                ,GetSetTxt  },
d121 2
a122 2
   { CmdPLOT,    "plt",   "Plot acquisitions"        ,""                   ,PlotAqn    },
   { CmdFILT,    "efl",   "Edit/Specify PTIM filter" ,""                   ,EditFilt   },
d124 2
a125 2
   { CmdWCCV,    "wccv",  "Write CCV to reference"   ,"Path"               ,WriteCcv   },
   { CmdCMP,     "cmp",   "Compare CCVs to reference","Path"               ,CompareCcv } };
@


1.1
log
@Initial revision
@
text
@d97 1
a97 1
   { CmdMOD,     "mod",   "Select target module"     ,"Mod"                ,GetSetMod  },
@
