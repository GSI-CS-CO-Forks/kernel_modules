head	1.11;
access;
symbols
	VersionKernel2-4:1.6
	Version2003:1.2;
locks; strict;
comment	@# @;


1.11
date	2012.04.18.13.14.42;	author sdeghaye;	state Exp;
branches;
next	1.10;

1.10
date	2008.12.04.15.54.50;	author nmn;	state Exp;
branches;
next	1.9;

1.9
date	2006.12.12.10.59.50;	author nmn;	state Exp;
branches;
next	1.8;

1.8
date	2006.03.21.15.05.37;	author sdeghaye;	state Exp;
branches;
next	1.7;

1.7
date	2005.06.29.07.55.10;	author sdeghaye;	state Exp;
branches;
next	1.6;

1.6
date	2005.06.08.07.48.52;	author sdeghaye;	state Exp;
branches;
next	1.5;

1.5
date	2004.10.13.06.35.08;	author sdeghaye;	state Exp;
branches;
next	1.4;

1.4
date	2004.03.16.14.10.27;	author sdeghaye;	state Released;
branches;
next	1.3;

1.3
date	2004.03.09.13.04.20;	author sdeghaye;	state Exp;
branches;
next	1.2;

1.2
date	2004.03.08.10.41.56;	author sdeghaye;	state Exp;
branches;
next	1.1;

1.1
date	2003.05.12.15.36.08;	author sdeghaye;	state Exp;
branches;
next	;


desc
@Makefile for the driver, the test program and the I/O lib
@


1.11
log
@Added 22 to 8 type support
@
text
@# Makefile for building the Kernel-Space Device Driver

ifndef CPU
CPU=L865
endif

ENV_PREFIX=/acc/sys/$(CPU)

ifeq ($(CPU),L865)
KERNELVERSION=2.6.24.7-rt21
endif
ifeq ($(CPU),L864)
KERNELVERSION=2.6.9-34
endif
KDIR := $(ENV_PREFIX)/usr/src/kernels/$(KERNELVERSION)

ifndef ACCS
ACCS=lab oper oplhc
endif

LIB_SRCS=pickeringmuxlib.c
DRV_SRCS=pickeringmuxmain.c pickering16to16.c pickering16to16a.c pickering4to1.c pickering9to8.c pickering22to8.c pickeringattn.c
TST_SRCS=test_driver.c
MY_CFLAGS= -g -Wall -I. -I/acc/local/$(CPU)/include
MY_LDFLAGS= -g

obj-m := pickeringmuxdrv.o
pickeringmuxdrv-objs := $(DRV_SRCS:.c=.o)

%.$(CPU).o: %.c
	$(CC) $(MY_CFLAGS) $< -c -o $@@

PWD := $(shell pwd)

all:    libpickeringmux.$(CPU).a test_driver.$(CPU) driver

libpickeringmux.$(CPU).a: $(LIB_SRCS:.c=.$(CPU).o)
	@@rm -f $@@
	ar crv $@@ $^
	ranlib $@@


test_driver.$(CPU): $(TST_SRCS:.c=.$(CPU).o) libpickeringmux.$(CPU).a
	@@rm -f $@@ /tmp/$@@
	$(CC) $(MY_LDFLAGS) $^  -L/acc/local/$(CPU)/lib -lpciioconfig -o /tmp/$@@
	mv /tmp/$@@ $@@

driver:
	$(MAKE) -C $(KDIR) SUBDIRS=$(PWD) modules

install: install_driver install_lib

install_driver: $(obj-m:.o=.ko) pickmuxinstall
	for a in $(ACCS); do \
	    dsc_install $^ /acc/dsc/$$a/$(CPU)/$(KERNELVERSION)/pickeringmux; \
	done

install_lib: libpickeringmux.$(CPU).a  pickeringmuxlib.h
	dsc_install $^ /acc/local/$(CPU)/pickering


clean:
	rm -f *~ core .*.cmd *.o *.ko -r .tmp* *.cmd.? .es* ,*
@


1.10
log
@*** empty log message ***
@
text
@d22 1
a22 1
DRV_SRCS=pickeringmuxmain.c pickering16to16.c pickering16to16a.c pickering4to1.c pickering9to8.c pickeringattn.c
d63 1
a63 1
	rm -f *~ core .*.cmd *.o *.ko -r .tmp*
@


1.9
log
@*** empty log message ***
@
text
@d4 1
a4 1
CPU=L86
d6 1
d8 3
a10 3
ifeq ($(CPU),L86)
KERNELVERSION=2.6.9-0.1.ab
KDIR := $(ENV_PREFIX)/usr/src/linux-$(KERNELVERSION)
d14 1
d16 1
a16 1
endif
d18 1
a18 1
ACCS=lab oper
d24 1
a24 1
MY_CFLAGS= -g -Wall -I. -I/ps/local/$(CPU)/include
d45 1
a45 1
	$(CC) $(MY_LDFLAGS) $^  -L/ps/local/$(CPU)/lib -lpciioconfig -o /tmp/$@@
d59 1
a59 1
	dsc_install $^ /ps/local/$(CPU)/pickering
@


1.8
log
@Add the specific files for the attenuator
@
text
@d3 1
d5 3
d9 9
a17 1
ENV_PREFIX=/ps/sys/L86
a30 1
KDIR := $(ENV_PREFIX)/usr/src/linux-$(KERNELVERSION)
d52 3
a54 1
	dsc_install $^ /ps/dsc/mcr/$(CPU)/$(KERNELVERSION)/pickeringmux
@


1.7
log
@Version for kernel 2.6.9
@
text
@d8 1
a8 1
DRV_SRCS=pickeringmuxmain.c pickering16to16.c pickering16to16a.c pickering4to1.c pickering9to8.c
@


1.6
log
@Complete the install part
@
text
@d1 1
a1 4
#
#       Makefile for building Linux driver for Pickering multiplexers
#
#
d3 3
a5 3
# Where is the system distribution
CPU=l86
ENV_PREFIX=/ps/sys/$(CPU)
d7 5
a11 2
# Include DSC program production rules
#include /ps/src/dsc/co/Make.auto
d13 2
a14 4
# Flags to compile driver
DRCFLAGS  = -DADAPTER_ID=\"$(ID)\" -D__KERNEL__ -DMODULE \
    -Wall -O1 -fomit-frame-pointer \
    -I$(ENV_PREFIX)/usr/src/linux-2.4.20-18.7.cern/include -I$(ENV_PREFIX)/usr/include -I.
d16 2
a17 2
# Flags to compile test program
CFLAGS=-Wall -g -I- -I. -I$(ENV_PREFIX)/usr/include -I/ps/local/$(CPU)/ 
d19 2
a20 5
LDFLAGS = -L/ps/local/$(CPU)/lib
LDLIBS = -lpciioconfig 
CC=$(ENV_PREFIX)/usr/bin/gcc
AR=$(ENV_PREFIX)/usr/bin/ar
LD=$(ENV_PREFIX)/usr/bin/ld
d22 1
d24 4
a27 3
SDRV=pickeringmuxmain.c pickering16to16.c pickering16to16a.c pickering4to1.c pickering9to8.c
SRCS=test_driver.c
LIBSRCS=pickeringmuxlib.c
a28 3
TARGETDRV = pickeringmuxdrv.o
TARGETLIB = libpickeringmux.a
TARGETHDR = pickeringmuxlib.h
d30 4
a33 1
ALL=$(TARGETDRV) $(TARGETLIB)  $(SRCS:.c=)
d35 2
a36 1
all: $(ALL)
d38 1
a38 3
pickeringmuxdrv.o: $(SDRV)
	$(CC) -c $(CPPFLAGS) $(DRCFLAGS) $^
	$(LD) -g -r -o $@@ $(LDIBS) $(SDRV:.c=.o)
d40 5
a44 1
$(SRCS:.c=): $(SRCS)
a45 3
libpickeringmux.a: $(LIBSRCS:.c=.o)
	$(RM) $@@
	$(AR) -crv $@@ $^
d48 1
a48 14
	rm -f $(ALL) ,* *.o \#* *~

insmod: $(SDRV:.c=.o)
	-/sbin/rmmod $(SDRV:.c=)            # must be root
	-/sbin/insmod -f $(SDRV:.c=.o)      # must be root
install:
	for a in $(ACCS); do \
	if [ -w /ps/dsc/$$a/$(CPU)/i686/pickeringmux ]; then    \
		echo Installing in /ps/dsc/$$a/$(CPU)/i686/pickeringmux ; \
		dsc_install $(TARGETDRV) /ps/dsc/$$a/$(CPU)/i686/pickeringmux ; \
	fi                                      \
	done
	dsc_install $(TARGETLIB) $(TARGETHDR) /ps/local/$(CPU)/pickering

@


1.5
log
@Add the pciioconfig lib.
@
text
@d10 3
d21 2
a22 1
LDFLAGS = -L/ps/local/$(CPU)/lib -lpciioconfig
d28 1
a28 1
SDRV=pickeringmuxmain.c pickering16to16.c pickering4to1.c pickering9to8.c
d32 3
d36 1
a36 1
ALL=pickeringmuxdrv.o libpickeringmux.a $(SRCS:.c=)
d42 1
a42 1
	$(LD) -g -r -o $@@ $(SDRV:.c=.o)
d57 8
a64 2
	dsc_install pickeringmuxdrv.o /ps/dsc/tst/l86/i686/pickeringmux
	dsc_install libpickeringmux.a /ps/local/l86/em
@


1.4
log
@Compile, link and install the driver with support for 4-1, 9-8, 16-16 modules.
@
text
@d7 2
a8 1
ENV_PREFIX=/ps/sys/l86
d16 1
a16 1
CFLAGS=-Wall -g -I- -I. -I$(ENV_PREFIX)/usr/include
d18 1
a18 1
LDFLAGS = -s -N
@


1.3
log
@Makefile for the multi-module driver
@
text
@d49 2
a50 2
	dsc_install pickeringmuxdrv.o /ps/dsc/tst/l86/i686/prfmux
	dsc_install libpickeringmux.a    /ps/local/l86/em
@


1.2
log
@Makefile version 2003
@
text
@d2 1
a2 1
#       Makefile for building Linux diriver for RF mux
d14 1
a14 1
# Falgs to compile test program
d20 1
d23 1
a23 1
SDRV=prfmuxdriver.c
d25 1
a25 1
LIBSRCS=prfmuxlib.c
d28 1
a28 1
ALL=$(SDRV:.c=.o) $(SRCS:.c=) libprfmux.a
d32 3
a34 3
$(SDRV:.c=.o): $(SDRV)
	$(CC) -c -o $@@ $(CPPFLAGS) $(DRCFLAGS) $^

d38 1
a38 1
libprfmux.a: $(LIBSRCS:.c=.o)
d49 2
a50 2
	dsc_install prfmuxdriver.o /ps/dsc/tst/l86/i686/prfmux
	dsc_install libprfmux.a    /ps/local/l86/em
@


1.1
log
@Initial revision
@
text
@d7 1
a7 1
ENV_PREFIX=/ps/sys/i386
d12 1
a12 1
    -I- -I$(ENV_PREFIX)/usr/src/linux-2.4.18/include -I. -I$(ENV_PREFIX)/usr/include
d47 3
@
